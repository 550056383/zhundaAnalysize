<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="zd.zdanalysis.mapper.ProjectInfoMapper">
    <!--查询是否存在该表-->
    <select id="selectTableByName" parameterType="string" resultType="string">
         show TABLES like #{tablename}
    </select>
    <!--临时表存在则删除-->
    <delete id="deleteTableByName" parameterType="string">
      DROP TEMPORARY TABLE IF EXISTS ${name}
    </delete>
    <update id="createTables" parameterType="string">
        create TEMPORARY table  ${param1} (
         <foreach collection="param2" item="Item" separator=",">
             ${Item} text
        </foreach>
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8
    </update>

    <insert id="insetData" parameterType="string">
        insert  ${param1}()
        values (
        <foreach collection="param2"  item="listItems" separator=",">
            " ${listItems} "
        </foreach>
        )
    </insert >
    <!--批量插入数据-->
    <insert id="insetDatas">
        insert ${param1}()
        values
        ${param2}

    </insert>
    <select id="selectResult"  resultType="java.util.LinkedHashMap" parameterType="string">
        select * from ${tables}
    </select>
    <select id="selectResults"  resultType="int" parameterType="string">
        select count(*) from ${tables}
    </select>

    <!--关联设置项表查询-->
    <!--
        <select id="selectTables" resultType="java.util.LinkedHashMap">
            select * from ${param1} inner join ${param3} on  ${param1}.${param2}=${param3}.${param4}
        </select>
    -->

    <select id="selectTables" resultType="java.util.LinkedHashMap">
        select * from ${param1} inner join ${param3} on  ${param1}.${param2}=${param3}.${param4}
    </select>

    <!--输出表字段-->
    <select id="selectTableCell" resultType="string">
        select ${param2} from ${param1}
    </select>

<!--    <select id="selectByWriteRules" parameterType="java.util.Map" resultType="java.util.LinkedHashMap">

        &lt;!&ndash;<foreach collection="map" item="table" separator="union">&ndash;&gt;
            select * from ${param0},${param3}
            where ${param0}.${param1}>${param3}.${param4}
            and ${param0}.${param1}-${param3}.${param4}>${param5}
        &lt;!&ndash;</foreach>&ndash;&gt;
    </select>-->
   <!-- <select id="selectByWriteRules"  resultType="java.util.LinkedHashMap">
        <foreach collection="majorsList"  item="m" separator="union" close="union">
        select * from ${m.table1},${m.table2}
        where ${m.table1}.${m.field1}>${m.table2}.${m.field2}
        and ${m.table1}.${m.field1}-${m.table2}.${m.field2}>${m.value}
        </foreach>

        <foreach collection="viceList" item="m" separator="union">
            select * from ${m.table1},${m.table2}
            where ${m.table1}.${m.field1} &gt; ${m.table2}.${m.field2}
            and ${m.table1}.${m.field1} - ${m.table2}.${m.field2}>${m.value}
        </foreach>
    </select>-->
    <!--两张表关联,多个输出字段,一个自定义字段,一个主条件(可选内容可为空)-->
    <select id="selectByWriteRules"  resultType="java.util.LinkedHashMap">
        <foreach collection="majorsList"  item="m" separator="union"  >
            <if test="tag==1">
                select
                <foreach collection="writeList" item="write" separator=",">
                    ${write.table}.${write.field}
                </foreach>
                from (${param1} inner join ${param3} on ${param1}.${param2}=${param3}.${param4})
            </if>
            <if test="tag==2">
                select
                <foreach collection="writeList" item="write" separator=",">
                    ${write.table}.${write.field}
                </foreach>
                from ( ${param1} inner join ${param3} on ${param1}.${param2}=${param3}.${param4})
            </if>
            <if test="num==1">
                <if test="tag==2">
                    where ${m.table1}.${m.field1} &gt; ${m.table2}.${m.field2}
                    and ${m.table1}.${m.field1} - ${m.table2}.${m.field2 }
                    <if test="tags==1">
                        &gt; '${m.value}'
                    </if>
                    <if test="tags==2">
                        >0
                    </if>
                </if>
                <if test="tag==1">
                    where ${m.table1}.${m.field1}
                    <if test="tags==1">
                        &gt; '${m.value}'
                    </if>
                    <if test="tags==2">
                        > 0
                    </if>
                </if>
            </if>
            <if test="num==2">
                <if test="tag==2">
                    where ${m.table1}.${m.field1}=${m.table2}.${m.field2}
                    <if test="tags==1">
                        = '${m.value}'
                    </if>
                    <if test="tags==2">

                    </if>
                </if>
                <if test="tag==1">
                    where ${m.table1}.${m.field1}
                    <if test="tags==1">
                        = '${m.value}'
                    </if>
                    <if test="tags==2">
                        = 0
                    </if>
                </if>
            </if>
            <if test="num==3">
                <if test="tag==2">
                    where ${m.table1}.${m.field1} &lt; ${m.table2}.${m.field2}
                    and ${m.table2}.${m.field2} - ${m.table1}.${m.field1 }
                    <if test="tags==1">
                        &lt; '${m.value}'
                    </if>
                    <if test="tags==2">
                        &lt; 0
                    </if>
                </if>
                <if test="tag==1">
                    where ${m.table1}.${m.field1}
                    <if test="tags==1">
                        &lt; '${m.value}'
                    </if>
                    <if test="tags==2">
                        &lt; 0
                    </if>
                </if>
            </if>
            <if test="num==4">
                <if test="tag==2">
                    where ${m.table1}.${m.field1} &gt;= ${m.table2}.${m.field2}
                    and ${m.table1}.${m.field1} - ${m.table2}.${m.field2 }
                    <if test="tags==1">
                        &gt;= '${m.value}'
                    </if>
                    <if test="tags==2">
                        &gt;=0
                    </if>
                </if>
                <if test="tag==1">
                    where ${m.table1}.${m.field1}
                    <if test="tags==1">
                        &gt;='${m.value}'
                    </if>
                    <if test="tags==2">
                        &gt;= 0
                    </if>
                </if>
            </if>
            <if test="num==5">
                <if test="tag==2">
                    where ${m.table1}.${m.field1} &lt;= ${m.table2}.${m.field2}
                    and ${m.table2}.${m.field2} - ${m.table1}.${m.field1 }
                    <if test="tags==1">
                        &lt;= '${m.value}'
                    </if>
                    <if test="tags==2">
                        &lt;= 0
                    </if>
                </if>
                <if test="tag==1">
                    where ${m.table1}.${m.field1}
                    <if test="tags==1">
                        &lt;= '${m.value}'
                    </if>
                    <if test="tags==2">
                        &lt;= 0
                    </if>
                </if>
            </if>
            <if test="num==6">
                <if test="tag==2">
                    where ${m.table1}.${m.field1} != ${m.table2}.${m.field2}
                    <if test="tags==1">
                        != '${m.value}'
                    </if>
                    <if test="tags==2">
                        !=0
                    </if>
                </if>
                <if test="tag==1">
                    where ${m.table1}.${m.field1}
                    <if test="tags==1">
                        != '${m.value}'
                    </if>
                    <if test="tags==2">
                        != 0
                    </if>
                </if>
            </if>

        </foreach>
    </select>

    <!--新增多张表关联,多个输出字段,一个自定义字段,一个主条件(可选内容可为空)-->
    <select id="selectByStatement" resultType="java.util.LinkedHashMap">
        <!--   select *  from
           ${param1}
           <foreach collection="tableRelevance" item="tr" >
            inner join ${tr.table2} on ${tr.table1}.${tr.fields1}=${tr.table2}.${tr.fields2}
           </foreach>-->
        <if test="tag==1">
            select
            <foreach collection="writeList" item="write" separator=",">
                ${write.table}.${write.field}
            </foreach>
            from
            ( ${param1}
            <foreach collection="tableRelevance" item="tr">
                inner join ${tr.table2} on ${tr.table1}.${tr.fields1}=${tr.table2}.${tr.fields2}
            </foreach>)where
        </if>
        <if test="tag==2">
            select
            <foreach collection="writeList" item="write" separator=",">
                ${write.table}.${write.field}
            </foreach>
            from
            (${param1}
            <foreach collection="tableRelevance" item="tr">
                inner join ${tr.table2} on ${tr.table1}.${tr.fields1}=${tr.table2}.${tr.fields2}
            </foreach>) where
        </if>
        <foreach collection="majorsList" item="m" separator="and">
            <if test="m.conditions==1">
                <if test="tag==2">
                    ${m.table1}.${m.field1} &gt; ${m.table2}.${m.field2}
                    and ${m.table1}.${m.field1} - ${m.table2}.${m.field2 }
                    <if test="tags==1">
                        &gt; '${m.value}'
                    </if>
                    <if test="tags==2">
                        >0
                    </if>
                </if>
                <if test="tag==1">
                    ${m.table1}.${m.field1}
                    <if test="tags==1">
                        &gt; '${m.value}'
                    </if>
                    <if test="tags==2">
                        > 0
                    </if>
                </if>
            </if>

            <if test="m.conditions==2">
                <if test="tag==2">
                    ${m.table1}.${m.field1}=${m.table2}.${m.field2}
                    <if test="tags==1">
                        and ${m.table2}.${m.field2} = '${m.value}'
                    </if>
                    <if test="tags==2">

                    </if>
                </if>
                <if test="tag==1">
                    ${m.table1}.${m.field1}
                    <if test="tags==1">
                        = '${m.value}'
                    </if>
                    <if test="tags==2">
                        = 0
                    </if>
                </if>
            </if>

            <if test="m.conditions==3">
                <if test="tag==2">
                    ${m.table1}.${m.field1} &lt; ${m.table2}.${m.field2}
                    and ${m.table2}.${m.field2} - ${m.table1}.${m.field1 }
                    <if test="tags==1">
                        &lt; '${m.value}'
                    </if>
                    <if test="tags==2">
                        &lt; 0
                    </if>
                </if>
                <if test="tag==1">
                    ${m.table1}.${m.field1}
                    <if test="tags==1">
                        &lt; '${m.value}'
                    </if>
                    <if test="tags==2">
                        &lt; 0
                    </if>
                </if>
            </if>

            <if test="m.conditions==4">
                <if test="tag==2">
                    ${m.table1}.${m.field1} &gt;= ${m.table2}.${m.field2}
                    and ${m.table1}.${m.field1} - ${m.table2}.${m.field2 }
                    <if test="tags==1">
                        &gt;= '${m.value}'
                    </if>
                    <if test="tags==2">
                        &gt;=0
                    </if>
                    <if test="tag==1">
                        ${m.table1}.${m.field1}
                        <if test="tags==1">
                            &gt;='${m.value}'
                        </if>
                        <if test="tags==2">
                            &gt;= 0
                        </if>
                    </if>
                </if>
            </if>

            <if test="m.conditions==5">
                <if test="tag==2">
                    ${m.table1}.${m.field1} &lt;= ${m.table2}.${m.field2}
                    and ${m.table2}.${m.field2} - ${m.table1}.${m.field1 }
                    <if test="tags==1">
                        &lt;= '${m.value}'
                    </if>
                    <if test="tags==2">
                        &lt;= 0
                    </if>
                    <if test="tag==1">
                        ${m.table1}.${m.field1}
                        <if test="tags==1">
                            &lt;= '${m.value}'
                        </if>
                        <if test="tags==2">
                            &lt;= 0
                        </if>
                    </if>
                </if>
            </if>

            <if test="m.conditions==6">
                <if test="tag==2">
                    ${m.table1}.${m.field1} != ${m.table2}.${m.field2}
                    <if test="tags==1">
                        and ${m.table2}.${m.field2} != '${m.value}'
                    </if>
                    <if test="tags==2">
                        !=0
                    </if>
                </if>
                <if test="tag==1">
                    ${m.table1}.${m.field1}
                    <if test="tags==1">
                        != '${m.value}'
                    </if>
                    <if test="tags==2">
                        != 0
                    </if>
                </if>
            </if>
        </foreach>

        <foreach collection="viceList" item="v">
            <if test="v.conditions==1">
                <if test="tag2==2">
                    and ${v.table1}.${v.field1} &gt; ${v.table2}.${v.field2}
                    and ${v.table1}.${v.field1} - ${v.table2}.${v.field2 }
                    <if test="tags2==1">
                        &gt; '${v.value}'
                    </if>
                    <if test="tags2==2">
                        >0
                    </if>
                </if>
                <if test="tag2==1">
                    and
                    ${v.table1}.${v.field1}
                    <if test="tags2==1">
                        &gt; '${v.value}'
                    </if>
                    <if test="tags2==2">
                        > 0
                    </if>
                </if>
            </if>

            <if test="v.conditions==2">
                <if test="tag2==2">
                    and
                    ${v.table1}.${v.field1}=${v.table2}.${v.field2}
                    <if test="tags2==1">
                        and ${v.table2}.${v.field2} = '${v.value}'
                    </if>
                    <if test="tags2==2">

                    </if>
                </if>
                <if test="tag2==1">
                    and
                    ${v.table1}.${v.field1}
                    <if test="tags2==1">
                        = '${v.value}'
                    </if>
                    <if test="tags2==2">
                        = 0
                    </if>
                </if>
            </if>

            <if test="v.conditions==3">
                and
                <if test="tag2==2">
                    ${v.table1}.${v.field1} &lt; ${v.table2}.${v.field2}
                    and ${v.table2}.${v.field2} - ${v.table1}.${v.field1 }
                    <if test="tags2==1">
                        &lt; '${v.value}'
                    </if>
                    <if test="tags2==2">
                        &lt; 0
                    </if>
                </if>
                <if test="tag2==1">
                    and
                    ${v.table1}.${v.field1}
                    <if test="tags2==1">
                        &lt; '${v.value}'
                    </if>
                    <if test="tags2==2">
                        &lt; 0
                    </if>
                </if>
            </if>

            <if test="v.conditions==4">
                and
                <if test="tag2==2">
                    ${v.table1}.${v.field1} &gt;= ${v.table2}.${v.field2}
                    and ${v.table1}.${v.field1} - ${v.table2}.${v.field2 }
                    <if test="tags2==1">
                        &gt;= '${v.value}'
                    </if>
                    <if test="tags2==2">
                        &gt;=0
                    </if>
                </if>
                <if test="tag2==1">
                    and
                    ${v.table1}.${v.field1}
                    <if test="tags2==1">
                        &gt;='${v.value}'
                    </if>
                    <if test="tags2==2">
                        &gt;= 0
                    </if>
                </if>
            </if>

            <if test="v.conditions==5">
                and
                <if test="tag2==2">
                    ${v.table1}.${v.field1} &lt;= ${v.table2}.${v.field2}
                    and ${v.table2}.${v.field2} - ${v.table1}.${v.field1 }
                    <if test="tags2==1">
                        &lt;= '${v.value}'
                    </if>
                    <if test="tags2==2">
                        &lt;= 0
                    </if>
                </if>
                <if test="tag2==1">
                    and
                    ${v.table1}.${v.field1}
                    <if test="tags2==1">
                        &lt;= '${v.value}'
                    </if>
                    <if test="tags2==2">
                        &lt;= 0
                    </if>
                </if>
            </if>

            <if test="v.conditions==6">
                and
                <if test="tag2==2">
                    ${v.table1}.${v.field1} != ${v.table2}.${v.field2}
                    <if test="tags2==1">
                        and ${v.table2}.${v.field2} != '${v.value}'
                    </if>
                    <if test="tags2==2">
                        !=0
                    </if>
                </if>
                <if test="tag2==1">
                    and
                    ${v.table1}.${v.field1}
                    <if test="tags2==1">
                        != '${v.value}'
                    </if>
                    <if test="tags2==2">
                        != 0
                    </if>
                </if>
            </if>
        </foreach>
    </select>
</mapper>